
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kru Pai Classroom ‚Ä¢ Prepositions Quiz (Set 1) + Review</title>
  <style>
    :root{
      --bg:#f7fafc; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --accent:#7c3aed; --accent2:#3b82f6; --good:#16a34a; --bad:#ef4444;
      --ring: rgba(124,58,237,.18);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: ui-rounded, "Poppins","Kanit", system-ui; background:var(--bg); color:var(--text)}
    .wrap{max-width:960px;margin:18px auto;padding:16px}
    .card{background:var(--card);border-radius:24px;box-shadow:0 10px 30px rgba(2,6,23,.06);padding:20px}
    h1{margin:0;font-size:clamp(22px,3.4vw,36px)}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{padding:12px 16px;border:none;border-radius:12px;font-weight:800;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .primary{background:linear-gradient(180deg,#8b5cf6,#7c3aed);color:#fff;box-shadow:0 10px 18px rgba(124,58,237,.25)}
    .ghost{background:#eef2ff;color:#312e81}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:800;font-size:12px}
    .progress{height:12px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,#3b82f6,#06b6d4);transition:width .35s ease}
    .qtext{font-size:clamp(18px,3vw,24px);font-weight:900;margin:8px 0}
    .olist{display:grid;gap:10px;margin-top:8px}
    .opt{border:2px solid #e5e7eb;border-radius:14px;padding:12px 14px;cursor:pointer;font-weight:700}
    .opt:hover{border-color:#c7d2fe}
    .opt.correct{background:#ecfdf5;border-color:#10b981}
    .opt.wrong{background:#fef2f2;border-color:#f87171}
    .disabled{pointer-events:none;opacity:.7}
    .hidden{display:none !important}
    input[type="text"]{width:100%;font-size:18px;padding:12px 14px;border-radius:12px;border:2px solid #e5e7eb;outline:none}
    input[type="text"]:focus{border-color:#8b5cf6;box-shadow:0 0 0 6px var(--ring)}
    footer{margin-top:10px;color:var(--muted);font-size:12px;text-align:center}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid #e5e7eb;padding:8px;text-align:left}
    th{background:#f8fafc}

    /* Brand bar */
    .kpc-brandbar{
      position:fixed; top:10px; left:10px; z-index:9999;
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 14px; border-radius:999px;
      background:linear-gradient(90deg,#fb7185,#f59e0b);
      color:#ffffff; font-weight:900; letter-spacing:.3px;
      box-shadow:0 10px 20px rgba(0,0,0,.18);
      user-select:none;
    }
    .kpc-brand-dot{
      width:28px; height:28px; border-radius:999px;
      background:#ffffff; color:#111827;
      display:grid; place-items:center; font-weight:900; font-size:14px;
      box-shadow:0 2px 8px rgba(0,0,0,.12);
    }
    @media (max-width:480px){
      .kpc-brandbar{transform:scale(.92); transform-origin:top left;}
    }
  </style>
</head>
<body>
<div class="kpc-brandbar"><div class="kpc-brand-dot">KP</div> Kru Pai Classroom</div>
<div class="wrap">

  <!-- START -->
  <section id="start" class="card">
    <h1>Prepositions Quiz ‚Äî Set 1</h1>
    <div class="muted">‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó ‚Ä¢ 30 ‡∏Ç‡πâ‡∏≠ (A‚ÄìD) ‚Äî ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏õ‡∏•‡∏≤‡∏¢</div>
    <div class="card" style="margin-top:12px">
      <b>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô (‡∏™‡∏±‡πâ‡∏ô ‡πÜ)</b>
      <ol style="margin:8px 0 0 18px">
        <li>‡∏Å‡∏î <b>‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠‡∏¢‡∏á‡πà‡∏≤‡∏¢</li>
        <li>‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>A‚ÄìD</b> ‚Äî ‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
        <li>‡∏Ñ‡∏£‡∏ö 30 ‡∏Ç‡πâ‡∏≠ ‡∏à‡∏∞‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤ <b>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</b> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</li>
        <li>‡∏ñ‡πâ‡∏≤ <b>‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°</b> ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö (‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 3 ‡∏£‡∏≠‡∏ö)</li>
      </ol>
      <div class="muted" style="margin-top:6px">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô: <b>80%</b> (‡πÑ‡∏î‡πâ ‚â• 24 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</div>
    </div>

    <div class="row" style="margin-top:14px">
      <div style="flex:1 1 280px">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
        <input id="playerName" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô Nita / 1/5" />
      </div>
      <div style="align-self:end; display:flex; gap:8px">
        <button id="btnReview" class="btn ghost">‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó üìò</button>
        <button id="btnStart" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‚ñ∂</button>
      </div>
    </div>
  </section>

  <!-- GAME -->
  <section id="game" class="card hidden">
    <div class="row" style="align-items:center;justify-content:space-between">
      <div class="pill" id="topicPill">Prepositions</div>
      <div class="row" style="align-items:center">
        <div><b id="score">0</b> ‚úÖ</div>
        <div>| <span id="done">0</span>/<span id="total">30</span></div>
      </div>
    </div>
    <div class="progress" style="margin:8px 0 6px"><span id="bar"></span></div>

    <div class="qtext" id="qtext">Question text</div>
    <div id="olist" class="olist"></div>

    <div class="row" style="margin-top:10px">
      <button id="btnNext" class="btn ghost hidden">‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
    </div>

    <footer id="footerGame"></footer>
  </section>

  <!-- REVIEW -->
  <section id="review" class="card hidden">
    <h2>‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó (Prepositions Review)</h2>
    <p class="muted">‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‚Äî ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>

    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 6px 0">üïí ‡πÄ‡∏ß‡∏•‡∏≤ (Time)</h3>
      <table>
        <thead><tr><th>‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó</th><th>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</th><th>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</th></tr></thead>
        <tbody>
          <tr><td><b>in</b></td><td>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢/‡πÄ‡∏¢‡πá‡∏ô, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</td><td>I brush my teeth <b>in</b> the morning.</td></tr>
          <tr><td><b>on</b></td><td>‡∏ß‡∏±‡∏ô/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</td><td>We go to school <b>on</b> Monday.</td></tr>
          <tr><td><b>at</b></td><td>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á</td><td>He sleeps <b>at</b> night.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 6px 0">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Place & Position)</h3>
      <table>
        <thead><tr><th>‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó</th><th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</th><th>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</th></tr></thead>
        <tbody>
          <tr><td><b>in</b></td><td>‡πÉ‡∏ô</td><td>The toys are <b>in</b> the box.</td></tr>
          <tr><td><b>on</b></td><td>‡∏ö‡∏ô</td><td>The book is <b>on</b> the table.</td></tr>
          <tr><td><b>at</b></td><td>‡∏ó‡∏µ‡πà (‡∏à‡∏∏‡∏î/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)</td><td>She is waiting <b>at</b> the bus stop.</td></tr>
          <tr><td><b>under</b></td><td>‡πÉ‡∏ï‡πâ</td><td>The cat is <b>under</b> the bed.</td></tr>
          <tr><td><b>between</b></td><td>‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á (2 ‡∏™‡∏¥‡πà‡∏á)</td><td>He sat <b>between</b> two chairs.</td></tr>
          <tr><td><b>behind</b></td><td>‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á</td><td>The garden is <b>behind</b> the house.</td></tr>
          <tr><td><b>in front of</b></td><td>‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤</td><td>There is a flag <b>in front of</b> the school.</td></tr>
          <tr><td><b>next to</b></td><td>‡∏ñ‡∏±‡∏î‡∏à‡∏≤‡∏Å/‡∏Ç‡πâ‡∏≤‡∏á ‡πÜ</td><td>My house is <b>next to</b> the park.</td></tr>
          <tr><td><b>above / over</b></td><td>‡πÄ‡∏´‡∏ô‡∏∑‡∏≠/‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô</td><td>A plane is flying <b>over</b> the city.</td></tr>
          <tr><td><b>below / under</b></td><td>‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤/‡πÉ‡∏ï‡πâ</td><td>The shoes are <b>under</b> the bed.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px">
      <h3 style="margin:0 0 6px 0">‚û°Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà (Movement)</h3>
      <table>
        <thead><tr><th>‡∏Ñ‡∏≥‡∏ö‡∏∏‡∏û‡∏ö‡∏ó</th><th>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</th><th>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</th></tr></thead>
        <tbody>
          <tr><td><b>into</b></td><td>‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äú‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‚Äù</td><td>She walked <b>into</b> the room.</td></tr>
          <tr><td><b>onto</b></td><td>‡∏Ç‡∏∂‡πâ‡∏ô ‚Äú‡πÑ‡∏õ‡∏ö‡∏ô‚Äù ‡∏û‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏ß</td><td>The cat jumped <b>onto</b> the bed.</td></tr>
          <tr><td><b>across</b></td><td>‡∏Ç‡πâ‡∏≤‡∏° ‚Äú‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏î‡πâ‡∏≤‡∏ô‚Äù</td><td>They ran <b>across</b> the road.</td></tr>
          <tr><td><b>through</b></td><td>‡∏ú‡πà‡∏≤‡∏ô ‚Äú‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‚Äù ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏î‡∏™‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á</td><td>We walked <b>through</b> the forest.</td></tr>
          <tr><td><b>down</b></td><td>‡∏•‡∏á/‡πÑ‡∏õ‡∏ï‡∏≤‡∏°</td><td>He walked <b>down</b> the stairs.</td></tr>
          <tr><td><b>out of</b></td><td>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å</td><td>She got <b>out of</b> the car.</td></tr>
          <tr><td><b>over</b></td><td>‡∏Ç‡πâ‡∏≤‡∏° ‚Äú‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‚Äù</td><td>The plane flew <b>over</b> the bridge.</td></tr>
          <tr><td><b>by</b></td><td>‡πÇ‡∏î‡∏¢/‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ (‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á)</td><td>We go to school <b>by</b> bus.</td></tr>
          <tr><td><b>on (foot)</b></td><td>‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏ó‡πâ‡∏≤</td><td>I go to school <b>on</b> foot.</td></tr>
          <tr><td><b>with</b></td><td>‡∏Å‡∏±‡∏ö/‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢</td><td>Come <b>with</b> me to the library.</td></tr>
          <tr><td><b>to / from</b></td><td>‡πÑ‡∏õ‡∏¢‡∏±‡∏á / ‡∏°‡∏≤‡∏à‡∏≤‡∏Å</td><td>This letter is <b>from</b> my friend <b>to</b> me.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="btnBackToStart" class="btn ghost">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
      <button id="btnStartFromReview" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‚ñ∂</button>
    </div>
  </section>

  <!-- SUMMARY -->
  <section id="summary" class="card hidden">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
    <div class="muted" id="playerLine">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: -</div>
    <div style="margin-top:8px">
      ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <b id="finalScore">0</b>/<b id="finalTotal">30</b> ‚Äî <span id="passStatus" class="pill">-</span>
    </div>
    <div class="muted" style="margin-top:6px">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô: 24/30 (80%)</div>

    <div class="card" style="margin-top:12px">
      <b>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ <span id="statName"></span> (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏£‡∏≠‡∏ö)</b>
      <table id="historyTable">
        <thead><tr><th>‡∏£‡∏≠‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th>‡∏ú‡∏•</th></tr></thead>
        <tbody id="historyBody"><tr><td colspan="5" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody>
      </table>
      <div id="attemptSummary" class="muted" style="margin-top:6px"></div>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="btnPlayAgain" class="btn primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà ‚ñ∂</button>
      <button id="btnBackStart" class="btn ghost">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    </div>
  </section>

  <footer>¬© Kru Pai Classroom</footer>
</div>

<script>
// ====== REVIEW HANDLERS ======
function showReview(){
  document.getElementById('start').classList.add('hidden');
  document.getElementById('game').classList.add('hidden');
  document.getElementById('summary').classList.add('hidden');
  document.getElementById('review').classList.remove('hidden');
}
function backToStart(){
  document.getElementById('review').classList.add('hidden');
  document.getElementById('summary').classList.add('hidden');
  document.getElementById('game').classList.add('hidden');
  document.getElementById('start').classList.remove('hidden');
}

// ====== CONFIG ======
const PASS_SCORE = 24; // 80% of 30
const STORAGE_PREFIX = 'kpc_prepositions_set1_history_';
const QUESTIONS = [
  {topic:'Prepositions', q:'The cat is hiding ____ the table.', opts:['on', 'under', 'in', 'at'], ans:1},
  {topic:'Prepositions', q:'There is a picture ____ the wall.', opts:['in', 'on', 'under', 'at'], ans:1},
  {topic:'Prepositions', q:'We arrived ____ the airport early.', opts:['in', 'on', 'at', 'into'], ans:2},
  {topic:'Prepositions', q:'The children are playing ____ the park.', opts:['in', 'at', 'on', 'by'], ans:0},
  {topic:'Prepositions', q:'She put the keys ____ her bag.', opts:['at', 'in', 'on', 'under'], ans:1},
  {topic:'Prepositions', q:'Dad waits ____ the bus stop every morning.', opts:['in', 'at', 'on', 'by'], ans:1},
  {topic:'Prepositions', q:'There is a big tree ____ our house.', opts:['between', 'in front of', 'behind', 'among'], ans:2},
  {topic:'Prepositions', q:'Please sit ____ me.', opts:['next to', 'between', 'behind', 'over'], ans:0},
  {topic:'Prepositions', q:'The ball rolled ____ the table.', opts:['above', 'under', 'between', 'behind'], ans:1},
  {topic:'Prepositions', q:'The bird is flying ____ the river.', opts:['over', 'between', 'into', 'behind'], ans:0},
  {topic:'Prepositions', q:'Mom put the vase ____ the shelf.', opts:['on', 'in', 'under', 'at'], ans:0},
  {topic:'Prepositions', q:'My school is ____ Bangkok.', opts:['in', 'at', 'on', 'into'], ans:0},
  {topic:'Prepositions', q:'The sun is ____ the clouds today.', opts:['between', 'under', 'behind', 'next to'], ans:2},
  {topic:'Prepositions', q:'We walked ____ the bridge to the other side.', opts:['across', 'through', 'into', 'onto'], ans:0},
  {topic:'Prepositions', q:'The dog jumped ____ the lake.', opts:['onto', 'into', 'across', 'over'], ans:1},
  {topic:'Prepositions', q:'He climbed ____ the roof carefully.', opts:['into', 'onto', 'to', 'over'], ans:1},
  {topic:'Prepositions', q:'The train goes ____ the tunnel.', opts:['across', 'over', 'through', 'between'], ans:2},
  {topic:'Prepositions', q:'The store is ____ the bank and the post office.', opts:['among', 'between', 'behind', 'in front of'], ans:1},
  {topic:'Prepositions', q:'We usually have lunch ____ noon.', opts:['in', 'on', 'at', 'by'], ans:2},
  {topic:'Prepositions', q:'She studies English ____ the morning.', opts:['in', 'on', 'at', 'by'], ans:0},
  {topic:'Prepositions', q:'The party is ____ Friday evening.', opts:['in', 'on', 'at', 'by'], ans:1},
  {topic:'Prepositions', q:'He came to school ____ bus.', opts:['by', 'with', 'on', 'in'], ans:0},
  {topic:'Prepositions', q:'I go to school ____ foot.', opts:['by', 'on', 'with', 'at'], ans:1},
  {topic:'Prepositions', q:'Can you come ____ me to the library?', opts:['with', 'by', 'to', 'from'], ans:0},
  {topic:'Prepositions', q:'This gift is ____ my best friend.', opts:['to', 'for', 'from', 'with'], ans:1},
  {topic:'Prepositions', q:'The letter is ____ my teacher.', opts:['to', 'for', 'from', 'with'], ans:2},
  {topic:'Prepositions', q:'We will travel ____ Chiang Mai next week.', opts:['to', 'at', 'in', 'on'], ans:0},
  {topic:'Prepositions', q:'Put your name ____ the top of the page.', opts:['in', 'at', 'on', 'under'], ans:2},
  {topic:'Prepositions', q:'Don‚Äôt run ____ the classroom.', opts:['into', 'over', 'across', 'in'], ans:3},
  {topic:'Prepositions', q:'The ball is ____ the two boxes.', opts:['among', 'between', 'behind', 'above'], ans:1}
];

// ====== UTIL ======
const $ = s => document.querySelector(s);
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function deepClone(x){ return JSON.parse(JSON.stringify(x)); }
function fmtTime(d){ return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }
function fmtDate(d){ return d.toLocaleDateString(); }

// ====== STATE ======
let player = '';
let seq = [];
let idx = 0;
let score = 0;
let answered = [];

function startGame(){
  player = ($('#playerName').value || '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô').trim();
  document.getElementById('footerGame').textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô: ${player}`;

  const base = deepClone(QUESTIONS);
  const order = shuffle([...Array(base.length).keys()]);
  seq = order.map(i => {
    const q = base[i];
    const opts = q.opts.map((t, i) => ({t, i}));
    shuffle(opts);
    const newOpts = opts.map(o => o.t);
    const newAns = opts.findIndex(o => o.i === q.ans);
    return {topic:q.topic, q:q.q, opts:newOpts, ans:newAns};
  });

  idx = 0; score = 0; answered = new Array(seq.length).fill(false);

  document.getElementById('start').classList.add('hidden');
  document.getElementById('review').classList.add('hidden');
  document.getElementById('summary').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
  renderQ();
}

function renderQ(){
  const q = seq[idx];
  document.getElementById('topicPill').textContent = q.topic;
  document.getElementById('qtext').textContent = `${idx+1}. ${q.q}`;
  document.getElementById('done').textContent = answered.filter(x=>x).length;
  document.getElementById('total').textContent = seq.length;
  document.getElementById('score').textContent = score;
  document.getElementById('bar').style.width = (100*answered.filter(x=>x).length/seq.length).toFixed(1) + '%';

  const olist = document.getElementById('olist');
  olist.innerHTML = '';
  ['A','B','C','D'].forEach((letter, k) => {
    const div = document.createElement('div');
    div.className = 'opt';
    div.dataset.index = k;
    div.innerHTML = `<b>${letter}.</b> ${q.opts[k]}`;
    div.addEventListener('click', onChoose);
    olist.appendChild(div);
  });
  document.getElementById('btnNext').classList.add('hidden');
}

function onChoose(e){
  const choice = Number(e.currentTarget.dataset.index);
  const q = seq[idx];

  Array.from(document.querySelectorAll('.opt')).forEach(el => el.classList.add('disabled'));

  if(choice === q.ans){
    e.currentTarget.classList.add('correct');
    score++;
  }else{
    e.currentTarget.classList.add('wrong');
    const correctEl = document.querySelector(`.opt[data-index="${q.ans}"]`);
    if(correctEl){ correctEl.classList.add('correct'); }
  }

  if(!answered[idx]){
    answered[idx] = true;
    document.getElementById('done').textContent = answered.filter(x=>x).length;
    document.getElementById('score').textContent = score;
    document.getElementById('bar').style.width = (100*answered.filter(x=>x).length/seq.length).toFixed(1) + '%';
  }

  const allDone = answered.every(x=>x);
  if(allDone){
    setTimeout(()=>finishGame(), 400);
  }else{
    document.getElementById('btnNext').classList.remove('hidden');
  }
}

function nextQ(){
  for(let k=1;k<=seq.length;k++){
    const ni = (idx + k) % seq.length;
    if(!answered[ni]){ idx = ni; break; }
  }
  renderQ();
}

function finishGame(){
  document.getElementById('game').classList.add('hidden');
  document.getElementById('summary').classList.remove('hidden');

  document.getElementById('playerLine').textContent = `‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: ${player}`;
  document.getElementById('finalScore').textContent = score;
  document.getElementById('finalTotal').textContent = seq.length;
  const pass = (score >= PASS_SCORE);
  const pill = document.getElementById('passStatus');
  pill.textContent = pass ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô';
  pill.style.background = pass ? '#ecfdf5' : '#fef2f2';
  pill.style.color = pass ? '#065f46' : '#7f1d1d';

  const key = STORAGE_PREFIX + player;
  const now = new Date();
  const rec = {score, total:seq.length, pass, ts: now.toISOString()};
  const hist = JSON.parse(localStorage.getItem(key) || '[]');
  hist.push(rec);
  localStorage.setItem(key, JSON.stringify(hist));

  document.getElementById('statName').textContent = player;
  const tbody = document.getElementById('historyBody');
  tbody.innerHTML = '';
  const last3 = hist.slice(-3);
  last3.forEach((r, i) => {
    const d = new Date(r.ts);
    const tr = document.createElement('tr');
    const roundNo = hist.length - last3.length + (i+1);
    tr.innerHTML = `<td>${roundNo}</td><td>${fmtDate(d)}</td><td>${fmtTime(d)}</td><td>${r.score}/${r.total}</td><td>${r.pass ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}</td>`;
    tbody.appendChild(tr);
  });
  if(last3.length===0){
    const tr = document.createElement('tr'); tr.innerHTML = `<td colspan="5" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>`; tbody.appendChild(tr);
  }

  const firstPassIdx = hist.findIndex(r => r.pass);
  const attemptTxt = (firstPassIdx>=0)
    ? `‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà <b>${firstPassIdx+1}</b> (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${hist.length} ‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ)`
    : `‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ${hist.length} ‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ`;
  document.getElementById('attemptSummary').innerHTML = attemptTxt;
}

document.getElementById('btnStart').addEventListener('click', startGame);
document.getElementById('btnNext').addEventListener('click', nextQ);
document.getElementById('btnPlayAgain').addEventListener('click', startGame);
document.getElementById('btnBackStart').addEventListener('click', backToStart);
document.getElementById('btnReview').addEventListener('click', showReview);
document.getElementById('btnBackToStart').addEventListener('click', backToStart);
document.getElementById('btnStartFromReview').addEventListener('click', startGame);
</script>
</body>
</html>
